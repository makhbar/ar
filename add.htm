<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مخبر | أطلق العنان</title>
    <link rel="stylesheet" href="./about.css">
    <link rel="stylesheet" href="./action.css">
    <link rel="stylesheet" href="./befores.css">
    <link rel="stylesheet" href="./footer.css">
    <link rel="stylesheet" href="./mainview.css">
    <link rel="stylesheet" href="./nav.css">
    <link rel="stylesheet" href="./cards.css">
    <link rel="stylesheet" href="./elements.css">

    <link rel="stylesheet" href="./font/css/sporto1.css">
    <link rel="stylesheet" href="./font/css/sporto2.css">
    <link rel="stylesheet" href="./font/css/sporto3.css">
    <link rel="stylesheet" href="./font/css/sporto4.css">
    <link rel="stylesheet" href="./font/css/sporto5.css">
    <link rel="stylesheet" href="./font/css/sporto6.css">
    <link rel="stylesheet" href="./font/css/cov.css">
    <link rel="stylesheet" href="./font/css/leCafeTech2.css">
    <link rel="stylesheet" href="./font/Tajawal.css">
    
    
</head>
<body>
    <div id="nav">
        <div id="nav-logo" style="height: 100%;">
            <img src="./logo.png" style="height: 100%;" alt="">
        </div>
        <div id="nav-menu-btn">
        </div>
    </div>
    <div id="nav-margin"></div>
    <div id="premainview">
        <div class="card card-smalltext bg-dark" style="background-color: rgb(115, 104, 187);">
            <label style="font-weight: bold;">أهلاً بك! هنا يمكنك إضافة أجهزتك</label>
            <label class="card-content" style="margin-bottom: 10px;">
                إنه الإصدار (ألفا) من التطبيق ، في الوقت الحالي يمكنك إضافة أجهزة
                باستخدام رمز الإدخال السري الخاص بك الذي حصلت عليه من إدارة المشروع
            </label>
        </div>
    </div>
    <div id="mainview">
        <div class="inputgroup">
            <label for="" class="required-after">اسم الجهاز</label>
            <input class="textbox req refill" id="dname" type="text" placeholder="مثال: مقياس فولت...">
            <span class="warn" id="dname-warn"></span>
        </div>
        <div class="inputgroup">
            <label for="">رقم الجهاز في المخبر</label>
            <input class="textbox refill" id="did" type="text" placeholder="مثال: A3-B...">
        </div>
        <div class="inputgroup">
            <label for="" class="required-after">النوع</label>
            <select class="textbox req refill" name="" id="dtype">
                <option value="">يرجى الاختيار</option>
                <option value="كهرباء وإلكترونيات">كهرباء وإلكترونيات</option>
                <option value="others">أخرى</option>
            </select>
            <span class="warn" id="dtype-warn"></span>
        </div>

        <div class="inputgroup">
            <label for="" class="required-after refill">شرح</label>
            <textarea class="textbox textarea req" name="" id="dabout" placeholder="ساعد الباحث على معرفة هذا الجهاز أكثر..."></textarea>
            <span class="warn" id="dabout-warn"></span>
        </div>

        <div class="inputgroup">
            <label for="" class="required-after">الكلية</label>
            <input class="textbox req" type="text" id="dcollege" placeholder="مثال: A3-B...">
            <span class="warn" id="dcollege-warn"></span>
        </div>

        <div class="inputgroup">
            <label for="" class="required-after">المخبر</label>
            <input class="textbox req" type="text" id="dlab" placeholder="مثال: A3-B...">
            <span class="warn" id="dlab-warn"></span>
        </div>

        <div class="inputgroup">
            <label for="" class="required-after">اسم صاحب الإدخال</label>
            <input class="textbox req" type="text" id="ddataent" placeholder="مثال: A3-B...">
            <span class="warn" id="dataent-warn"></span>
        </div>

        <div class="inputgroup">
            <label for="" class="required-after">الرمز السري</label>
            <input class="textbox req" type="password" id="key" placeholder="رمز الإدخال الخاص بك...">
            <span class="warn" id="key-warn"></span>
        </div>

        <center>
            <br>
            <div class="inputgroup">
                <button class="btn formbtn" onclick="add(event)">
                    إضافة الجهاز
                </button>
            </div>
        </center>

        <div class="warn-card" id="notifer">
            <span class="card-headline chemlab-before" id="note">
                يرجى ملئ الحقول المطلوبة
            </span>
        </div>
        <br><br><br>
    </div>
    <div id="action"></div>


    <center>
        <div id="footer">
            جميع الحقوق محفوظة © <br>
            Copyright © 
        </div>
    </center>
</body>
</html>

<script src="./jslib.js"></script>
<script>
    function add(e){
        inputs = document.getElementsByClassName("warn")
        for (let index = 0; index < inputs.length; index++) {
            const element = inputs[index];
            element.innerHTML = ""
        }
        //check for required fields filled:
        requiredFilled = true
        reqs = document.getElementsByClassName("req")
        for (let index = 0; index < reqs.length; index++) {
            const required = reqs[index];
            if(required.value == ""){
                document.getElementById(required.id + "-warn").innerHTML = "هذا الحقل مطلوب"
                requiredFilled = false
                window.scrollTo(0,0)
                notify("يرجى ملئ الحقول المطلوبة")
            }
        }

        if(requiredFilled){
            thisHTML = e.target.innerHTML
            thisBg = e.target.style.backgroundColor
            e.target.innerHTML = "جار الإضافة..."
            e.target.style.backgroundColor = "rgb(64,64,64)"
            e.target.style.cursor = "not-allowed"

            req = _v$("key")+"/"+_v$("dname")+"/"+_v$("did")+"/"+_v$("dtype")+"/"+_v$("dabout")+"/"+_v$("dcollege")+"/"+_v$("dlab")+"/"+_v$("ddataent")

            httpgo("https://waseemssaeed.pythonanywhere.com/mak/add/", req, (result, error)=>{
                if(result == "_ok"){
                    e.target.innerHTML = "تمت الإضافة"
                    setTimeout(()=>{
                        e.target.style.backgroundColor = thisBg
                        e.target.innerHTML = thisHTML
                        refills = document.getElementsByClassName("refill")
                        for (let index = 0; index < refills.length; index++) {
                            const element = refills[index];
                            element.value = ""
                        }
                        window.scrollTo(0,0)
                        e.target.style.cursor = "pointer"
                    }, 600)
                } else if (result == "nokey"){
                    e.target.innerHTML = "المفتاح السري خاطئ - أعد المحاولة "
                    e.target.style.backgroundColor = thisBg
                    setTimeout(()=>{
                        e.target.style.backgroundColor = thisBg
                        e.target.innerHTML = thisHTML
                        e.target.style.cursor = "pointer"
                    }, 1000)
                }
                else {
                    e.target.innerHTML = "خطأ في الشبكة - اضغط للمحاولة"
                    e.target.style.backgroundColor = thisBg
                    e.target.style.cursor = "pointer"
                }
            })
            /*filedata = new FormData()
            files = document.getElementById("image").files
            for (let index = 0; index < files.length; index++) {
                const file = document.getElementById("image").files[index];
                filedata.append("files[]", file)
                new XMLHttpRequestUpload
            }
            
            setTimeout(()=>{
                e.target.innerHTML = "تمت الإضافة"
                e.target.style.backgroundColor = "slateblue"
                setTimeout(()=>{
                    e.target.style.backgroundColor = thisBg
                    e.target.innerHTML = thisHTML
                    window.scrollTo(0,0)
                }, 1000)
            }, 2000)*/
        }
    }

    document.getElementById("notifer").style.display = "none"

    inputs = document.getElementsByClassName("textbox")
    for (let index = 0; index < inputs.length; index++) {
        const element = inputs[index];
        element.value = ""
    }

    function notify(note){
        document.getElementById("notifer").style.display = "block"
        document.getElementById("note").innerHTML = "&nbsp;&nbsp;" + note

        setTimeout(() => {
            document.getElementById("notifer").style.display = "none"
        }, 2000);
    }

    window.scrollTo(0,0)
</script>

<script>
    function prepare(raw){
        return raw.replaceAll(/&/g, "%26").replaceAll(/\'/g, "\\'").replaceAll(/\"/g, '\\"').replaceAll(/(?:\r\n|\r|\n)/g, '<br>')
    }

</script>